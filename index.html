<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoek-Brown vs Mohr-Coulomb Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .input-group {
            margin-bottom: 10px;
        }
        #failurePlotDiv {
            width: 100%; /* Dynamic width to fit the container */
            margin: 0 auto; /* Center the plot */
        }
        canvas {
            display: block;
            max-width: 100%;
            max-height: 100%;
        }
        #parameters, #results {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Hoek-Brown vs Mohr-Coulomb Calculator</h1>

    <div id="parameters">
        <h2>Input Parameters</h2>
        <div class="input-group">
            <label for="UCSi">Uniaxial Compressive Strength (UCSi, MPa): </label>
            <input type="number" id="UCSi" value="10" step="0.1">
        </div>
        <div class="input-group">
            <label for="GSI">Geological Strength Index (GSI): </label>
            <input type="number" id="GSI" value="50" step="0.1">
        </div>
        <div class="input-group">
            <label for="mi">mi: </label>
            <input type="number" id="mi" value="10" step="0.1">
        </div>
        <div class="input-group">
            <label for="D">Disturbance Factor (D): </label>
            <input type="number" id="D" value="0" step="0.1" min="0" max="1">
        </div>
        <div class="input-group">
            <label for="density">Rock Density (MN/m³): </label>
            <input type="number" id="density" value="0.025" step="0.001">
        </div>
        <div class="input-group">
            <label for="depth">Depth (m): </label>
            <input type="number" id="depth" value="150" step="1">
        </div>
        <button onclick="runCalculations()">Calculate and Update Plot</button>
    </div>

    <div id="results">
        <h2>Results</h2>
        <p><strong>Hoek-Brown Parameters:</strong> <span id="hbParams"></span></p>
        <p><strong>Mohr-Coulomb Parameters:</strong> <span id="mcParams"></span></p>
    </div>

    <h2>Plot</h2>
    <div id="failurePlotDiv">
        <canvas id="failurePlot"></canvas>
    </div>

    <script>
        // Initialization
        const ctx = document.getElementById('failurePlot').getContext('2d');
        let chart = null;

        // Hoek-Brown Calculation
        function hoekBrown(sig3, sigC, m, s, a) {
            return sig3 + sigC * Math.pow(m * (sig3 / sigC) + s, a);
        }

        // Mohr-Coulomb Calculation
        function mohrCoulomb(sig3, sigma_3, sigC, m, s, a) {
            const nfi = 1 + a * m * Math.pow(m * (sigma_3 / sigC) + s, a - 1);
            const c = 1 / (2 * Math.sqrt(nfi)) * (((1 - nfi) * sigma_3) + (sigC * Math.pow(m * (sigma_3 / sigC) + s, a)));
            return nfi * sig3 + 2 * c * Math.sqrt(nfi);
        }

        // Function to calculate cohesion (c), friction angle (phi), and rock strength
        function sigma_cm_and_c_and_phi(sigma_3, sigC, m, s, a) {
            const nfi = 1 + a * m * Math.pow(m * (sigma_3 / sigC) + s, a - 1);
            const phi = (2 * Math.atan(Math.sqrt(nfi)) - Math.PI / 2) * (180 / Math.PI); // Convert to degrees
            const c = (1 / (2 * Math.sqrt(nfi))) * (((1 - nfi) * sigma_3) + (sigC * Math.pow(m * (sigma_3 / sigC) + s, a)));
            const sigma_cm = 2 * c * Math.sqrt(nfi);
            return { nfi, phi, c, sigma_cm };
        }

        // Function to round number properly for tick labels
        function integerTickFormatter(value) {
            return Math.round(value).toString(); // Round to nearest integer, then convert to string
        }

        // Update calculations and plot
        function runCalculations() {
            // Gather user inputs
            const UCSi = parseFloat(document.getElementById('UCSi').value);
            const GSI = parseFloat(document.getElementById('GSI').value);
            const mi = parseFloat(document.getElementById('mi').value);
            const D = parseFloat(document.getElementById('D').value);
            const density = parseFloat(document.getElementById('density').value);
            const depth = parseFloat(document.getElementById('depth').value);
            const sigma_3 = density * depth; // Overburden pressure

            // Calculate Hoek-Brown parameters mb, s, a
            const mb = mi * Math.exp((GSI - 100) / 28 - 14 * D);
            const s = Math.exp((GSI - 100) / 9 - 3 * D);
            const a = 0.5 + 1 / 6 * (Math.exp(-GSI / 15.0) - Math.exp(-20.0 / 3.0));

            // Calculate Mohr-Coulomb parameters (including cohesion and friction angle)
            const mcResults = sigma_cm_and_c_and_phi(sigma_3, UCSi, mb, s, a); // {c, phi, sigma_cm, nfi}

            // Update results in HTML
            document.getElementById('hbParams').innerText = `mb = ${mb.toFixed(2)}, s = ${s.toFixed(4)}, a = ${a.toFixed(3)}`;
            document.getElementById('mcParams').innerText = `Cohesion (c): ${mcResults.c.toFixed(2)} MPa, Friction Angle (phi): ${mcResults.phi.toFixed(2)}°`;

            // Prepare data for plotting
            const sig3Values = [];
            const sig1HB = [];
            const sig1MC = [];

            for (let sig3 = -UCSi / mb; sig3 <= 1.2 * sigma_3; sig3 += 0.1) {
                sig3Values.push(sig3);
                sig1HB.push(hoekBrown(sig3, UCSi, mb, s, a));
                sig1MC.push(mohrCoulomb(sig3, sigma_3, UCSi, mb, s, a));
            }

            // Redraw the chart
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sig3Values, // X-axis labels (σ3 values)
                    datasets: [
                        { label: 'Hoek-Brown', data: sig1HB, borderColor: 'red', borderWidth: 2, fill: false, tension: 0 },
                        { label: 'Mohr-Coulomb', data: sig1MC, borderColor: 'blue', borderWidth: 2, fill: false, tension: 0 }
                    ]
                },
                options: {
                    responsive: true, // Responsive and dynamic sizing
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: { display: true, text: 'σ3 (MPa)' },
                            ticks: {
                                callback: integerTickFormatter, // No decimals on labels
                            }
                        },
                        y: {
                            title: { display: true, text: 'σ1 (MPa)' },
                            min: 0, // No negative y-axis values
                            ticks: {
                                callback: integerTickFormatter // No decimals on labels
                            }
                        }
                    }
                }
            });
        }

        // Perform initial calculations on page load
        runCalculations();
    </script>
</body>
</html>